---
title: "countydata"
author: "Gabe Cederberg"
date: "4/24/2020"
output: html_document
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)

options(tigris_use_cache = TRUE)

# Loading the important packages.

library(tidyverse)
library(dplyr)
library(readr)
library(fivethirtyeight)
library(janitor)
library(ggthemes)
library(gt)
library(reprex)
library(magrittr)
library(stringr)
library(haven)
library(infer)
library(readxl)
library(viridis)  
library(RCurl)
library(gifski)
library(gganimate)
library(tidycensus)

```

# {.tabset}

## First analysis

```{r, echo = FALSE, warning = FALSE}
# Loading in state data from NYT. 

county_text <- getURL("https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv")
county_a <- read_csv(county_text)

county <- county_a %>% 
  mutate(region = case_when(state == "Connecticut" |
                           state == "Maine" |
                           state == "Massachusetts" |
                           state == "New Hampshire" |
                           state == "Rhode Island" |
                           state == "Vermont" |
                           state == "New Jersey" |
                           state == "New York" |
                           state == "Pennsylvania" ~ "Northeast",
                           
                           state == "Illinois" |
                             state == "Indiana" |
                             state == "Michigan" |
                             state == "Ohio" |
                             state == "Wisconsin" |
                             state == "Iowa" |
                             state == "Kansas" |
                             state == "Minnesota" |
                             state == "Missouri" |
                             state == "Nebraska" |
                             state == "North Dakota" |
                             state == "South Dakota" ~ "Midwest",
                           
                             state == "Delaware" |
                             state == "Florida" |
                             state == "Georgia" |
                             state == "Maryland" |
                             state == "North Carolina" |
                             state == "South Carolina" |
                             state == "Virginia" |
                             state == "District of Columbia" |
                             state == "West Virginia" |
                             state == "Alabama" |
                             state == "Kentucky" |
                             state == "Mississippi" |
                             state == "Tennessee" |
                             state == "Arkansas" |
                             state == "Louisiana" |
                             state == "Oklahoma" |
                             state == "Texas" ~ "South",
                           
                             state == "Arizona" |
                             state == "Colorado" |
                             state == "Idaho" |
                             state == "Montana" |
                             state == "Nevada" |
                             state == "New Mexico" |
                             state == "Utah" |
                             state == "Wyoming" |
                             state == "Alaska" |
                             state == "California" |
                             state == "Hawaii" |
                             state == "Oregon" |
                             state == "Washington" ~ "West",
                           
                            state == "Northern Mariana Islands" | 
                             state == "Puerto Rico" | 
                             state == "Guam" | 
                             state == "Virgin Islands" ~ "Other" ))

partisanship_text <- getURL("https://raw.githubusercontent.com/MEDSL/2018-elections-unoffical/master/election-context-2018.csv")
partisanship <- read_csv(partisanship_text,
                         col_types = cols(
                fips = col_character()))

partial_merged <- county %>% 
  left_join(partisanship, by = c("county", "state"))

counties <- get_acs(geography = "county",
                  variables = c(pop = "B00001_001"), 
                  year = 2018,
            #      state = "MN",
           #       county = "Ramsey",
                  geometry = TRUE,
                  shift_geo = TRUE) %>% 
  clean_names() %>% 
   select(geoid, 
          name, 
          "pop" = estimate,
          geometry) %>% 
  separate(col = name, c("county", "state"), sep = ", ")

counties

merged <- counties %>% 
  left_join(partial_merged, by = c("geoid" = "fips.x"))

merged
```


```{r}
merged

merged %>% 
  # filter(state == "Minnesota" &
   #         date == "2020-04-16") %>% 
    ggplot(aes(fill = cases, color = cases)) +
  geom_sf(data = merged, na.rm = TRUE) +
  # scale_fill_viridis_d(direction = -1) +
  # scale_color_viridis_d(direction = -1) +
  labs(title = "Racial geography of Ramsey County, Minnesota",
       caption = "Source: American Community Survey 2014-2018") +
  theme_void()

```
